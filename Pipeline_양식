pipeline {
    agent any
    environment {
        GITHUB_URL = 'https://github.com/gibeom01/final_project.git'
        TF_DIR = 'AWS_GCP_terraform'  // Terraform 코드가 있는 디렉토리 경로
    }
    stages {
        stage('Checkout Code') {
            steps {
                // GitHub 리포지토리 체크아웃
                checkout scmGit(branches: [[name: '*/main']],
                    userRemoteConfigs: [[url: "${GITHUB_URL}"]])
            }
        }

        stage('Terraform Init and Apply') {
            steps {
                // Terraform 코드 초기화 및 적용
                dir("${TF_DIR}") {
                    sh """
                        terraform init
                        terraform apply -auto-approve
                    """
                }
            }
        }
    }
}
